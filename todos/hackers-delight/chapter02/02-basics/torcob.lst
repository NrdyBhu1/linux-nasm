     1                                  ; torcob.asm
     2                                  ; turn off the rightmost contigious string of one bits
     3                                  
   401                                  [list -]
   402                                  
   403                                  bits 64
   404                                  
   405                                  section .bss
   406 00000000 <res 00000001>            buffer: resb 1
   407                                  
   408                                  section .data
   409                                    
   410                                  section .text
   411                                  global _start
   412                                  
   413                                  _start:
   414                                  
   415 00000000 B830520400                    mov     rax, 0x0000000000045230
   416 00000005 E827000000                    call    printBinary
   417 0000000A E80F000000                    call    torcob
   418 0000000F E81D000000                    call    printBinary
   419                                  
   420 00000014 4831FF                        xor     rdi, rdi
   421 00000017 B83C000000                    mov     rax, SYS_EXIT
   422 0000001C 0F05                          syscall
   423                                  
   424                                  torcob:                                ; turn off the rightmost contigious string of one bits
   425 0000001E 4889C3                        mov     rbx, rax
   426 00000021 48F7D8                        neg     rax
   427 00000024 4821C3                        and     rbx, rax
   428 00000027 48F7D8                        neg     rax
   429 0000002A 4801C3                        add     rbx, rax
   430 0000002D 4821D8                        and     rax, rbx
   431 00000030 C3                            ret
   432                                        
   433                                  printBinary:
   434 00000031 50                            push      rax
   435 00000032 B940000000                    mov       rcx, 64                 ; 64 bits to display
   436 00000037 F8                            clc                               ; clear carry flag
   437                                  .repeat:
   438 00000038 48D1D0                        rcl       rax, 1                  ; start with leftmost bit
   439 0000003B 801425[00000000]30            adc       BYTE[buffer],0x30       ; make it ASCII
   440 00000043 51                            push      rcx
   441 00000044 50                            push      rax
   442 00000045 E813000000                    call      printBuffer
   443 0000004A 58                            pop       rax
   444 0000004B 59                            pop       rcx
   445 0000004C E2EA                          loop      .repeat
   446 0000004E C60425[00000000]0A            mov       BYTE[buffer],0x0A
   447 00000056 E802000000                    call      printBuffer
   448 0000005B 58                            pop       rax
   449 0000005C C3                            ret
   450                                  
   451                                  printBuffer:
   452 0000005D B801000000                    mov       rax, SYS_WRITE
   453 00000062 BF01000000                    mov       rdi, STDOUT
   454 00000067 48BE-                         mov       rsi, buffer
   455 00000069 [0000000000000000] 
   456 00000071 BA01000000                    mov       rdx, 1
   457 00000076 0F05                          syscall
   458 00000078 802425[00000000]00            and       BYTE[buffer],0          ; clear buffer
   459 00000080 C3                            ret
